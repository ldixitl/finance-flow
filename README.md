# Проект *Finance Flow* 

## Описание

*Finance Flow* — это приложение для анализа финансовых транзакций, формирования отчетов и предоставления сервисов. Оно позволяет загружать, фильтровать, анализировать транзакции, рассчитывать кешбэк, сохранять отчеты и получать актуальные курсы валют и акций.

### Реализованные функции:
#### Веб-страницы (модуль `views.py`)
- **Главная страница** предоставляет JSON-ответ с:
  - Приветствием в зависимости от времени суток.
  - Информацией о расходах по картам и начисленном кешбэке.
  - Топ-5 самых затратных транзакций.
  - Курсами валют и ценами акций S&P500.

#### Взаимодействие с API (модуль `external_api.py`)
- **Получение курсов валют** (`currency_exchanger`) — использует API для конвертации валют в рубли.
- **Получение стоимости акций** (`stock_exchanger`) — получает цены акций из API.

#### Загрузка и обработка транзакций (модуль `utils.py`)
- **Загрузка транзакций из файла** (`transaction_parser`) — читает XLSX-файл и формирует DataFrame с транзакциями.
- **Фильтрация по дате** (`filter_transactions_by_month`) — выбирает транзакции за текущий месяц.
- **Группировка трат по картам** (`cost_analysis`) — считает сумму расходов и кешбэк по каждой карте.
- **Топ-5 транзакций** (`get_top_transactions`) — находит самые крупные расходы.

#### Сервисы (модуль `services.py`)
- **Анализ выгодных категорий кешбэка** (`cashback_analysis`) — рассчитывает сумму кешбэка по категориям.
- **Инвесткопилка** (`investment_bank`) — округляет покупки и сохраняет разницу на накопительный счет.
- **Поиск транзакций** (`searching_transactions`) — фильтрует транзакции по ключевым словам в описании.
- **Поиск номеров телефонов** (`find_phone_numbers`) — ищет телефонные номера в описании транзакций.
- **Поиск переводов физлицам** (`find_personal_transfer`) — определяет переводы на основании имени и первой буквы фамилии.

#### Отчёты (модуль `reports.py`)
- **Декоратор для сохранения отчетов** (`save_to_file`) — сохраняет результат функции-отчета в JSON-файл.
- **Траты по категории** (`spending_by_category`) — анализирует расходы в категории за последние три месяца.

## Примеры работы функций

### Анализ кешбэка
```python
from src.services import cashback_analysis

transactions = [
    {"Дата операции": "15.12.2021", "Категория": "Продукты", "Сумма операции": -5000},
    {"Дата операции": "10.12.2021", "Категория": "Развлечения", "Сумма операции": -2000},
]
print(cashback_analysis(transactions, 2021, 12))
```

### Инвесткопилка
```python
from src.services import investment_bank

transactions = [
    {"Дата операции": "15.12.2021", "Сумма операции": -178},
    {"Дата операции": "10.12.2021", "Сумма операции": -345},
]
print(investment_bank(transactions, "2021-12", 50))
```

### Поиск транзакций по ключевому слову
```python
from src.services import searching_transactions

transactions = [
    {"Описание": "Оплата в кафе"},
    {"Описание": "Покупка в супермаркете"},
]
print(searching_transactions(transactions, "кафе"))
```

### Поиск номеров телефонов в транзакциях
```python
from src.services import find_phone_numbers

transactions = [
    {"Описание": "Перевод на +7 999 123-45-67"},
    {"Описание": "Оплата коммуналки"},
]
print(find_phone_numbers(transactions))
```

### Поиск переводов физическим лицам
```python
from src.services import find_personal_transfer

transactions = [
    {"Описание": "Перевод Валерий А.", "Категория": "Переводы"},
    {"Описание": "Перевод компании", "Категория": "Переводы"},
]
print(find_personal_transfer(transactions))
```

## Установка
1. Клонируйте репозиторий:
```sh
git clone https://github.com/ldixitl/finance-flow.git
```
Используется Poetry для управления зависимостями. Убедитесь, что Poetry установлен.
После установки выполните:
2. Установите зависимости:
```sh
poetry install
```
3. Создайте файл `.env` и укажите API-ключи для получения курсов валют и акций. [**Шаблон такого файла**](.env.sample).

## Использование
Запуск основного скрипта:
```sh
python main.py
```
Приложение загружает транзакции, анализирует данные и формирует отчеты в формате JSON.

## Тестирование
Для тестирования в проекте используются **pytest** и плагин **pytest-cov** для измерения покрытия кода тестами.

### Запуск тестов
Чтобы запустить тесты, выполните команду:
```bash
pytest
```

### Отчёт о покрытии кода
Для генерации отчёта о покрытии кода в формате HTML выполните:

```bash
pytest --cov=src --cov-report=html
```
После выполнения команда сгенерирует папку **htmlcov**, содержащую отчёт. 
Откройте файл **htmlcov/index.html** в браузере, чтобы просмотреть детализированный отчёт.

## Лицензия
Этот проект лицензирован по [лицензии MIT](LICENSE).
