from typing import Dict, List

import pandas as pd
import pytest


@pytest.fixture
def sample_transactions() -> List[Dict]:
    """Пример списка транзакций в новом формате."""
    return [
        {"Дата операции": "10.02.2024 12:10:15", "Номер карты": "*7197", "Статус": "OK", "Сумма операции": -500},
        {"Дата операции": "12.01.2024 08:45:50", "Номер карты": "*7197", "Статус": "OK", "Сумма операции": -1500},
        {"Дата операции": "29.01.2024 09:30:10", "Номер карты": "*1234", "Статус": "OK", "Сумма операции": -200},
        {
            "Дата операции": "09.02.2024 07:25:10",
            "Номер карты": "*1234",
            "Статус": "OK",
            "Сумма операции": 300,
        },  # Доход
        {
            "Дата операции": "27.01.2024 18:45:50",
            "Номер карты": "*5678",
            "Статус": "OK",
            "Сумма операции": "-100",
        },  # Строка
        {
            "Дата операции": "11.02.2024 19:00:05",
            "Номер карты": "*5678",
            "Статус": "OK",
            "Сумма операции": "abc",
        },  # Ошибка
        {
            "Дата операции": "10.02.2024 11:55:25",
            "Номер карты": None,
            "Статус": "OK",
            "Сумма операции": -400,
        },  # Без номера карты
    ]


@pytest.fixture
def sample_top_transactions() -> List[Dict]:
    """Пример списка транзакций для топ-5."""
    return [
        {"Дата операции": "10.02.2024 12:10:15", "Номер карты": "*1111", "Статус": "OK", "Сумма операции": -500},
        {"Дата операции": "12.02.2024 08:45:50", "Номер карты": "*2222", "Статус": "OK", "Сумма операции": -1500},
        {"Дата операции": "08.02.2024 14:20:30", "Номер карты": "*3333", "Статус": "OK", "Сумма операции": -200},
        {
            "Дата операции": "15.02.2024 19:00:05",
            "Номер карты": "*4444",
            "Статус": "OK",
            "Сумма операции": 300,
        },  # Доход
        {"Дата операции": "11.02.2024 09:35:20", "Номер карты": "*5555", "Статус": "OK", "Сумма операции": -100},
        {"Дата операции": "09.02.2024 07:25:10", "Номер карты": "*6666", "Статус": "OK", "Сумма операции": -400},
        {"Дата операции": "07.02.2024 22:15:40", "Номер карты": "*7777", "Статус": "OK", "Сумма операции": -50},
        {"Дата операции": "13.02.2024 17:50:00", "Номер карты": "*8888", "Статус": "OK", "Сумма операции": -900},
        {"Дата операции": "14.02.2024 11:55:25", "Номер карты": "*9999", "Статус": "OK", "Сумма операции": -1200},
    ]


@pytest.fixture
def sample_transactions_df() -> pd.DataFrame:
    """Тестовый DataFrame с транзакциями"""
    return pd.DataFrame(
        {
            "Дата операции": ["15.12.2021 10:30:00", "10.11.2021 14:00:00", "05.12.2021 18:45:00"],
            "Категория": ["Переводы", "Продукты", "Переводы"],
            "Сумма": [5000, 1500, 2000],
        }
    )


@pytest.fixture
def sample_transactions_cashback() -> List[Dict]:
    return [
        {"Дата операции": "15.01.2024 12:30:00", "Категория": "Продукты", "Сумма операции": -1530},
        {"Дата операции": "18.01.2024 14:00:00", "Категория": "Кафе", "Сумма операции": -810},
        {"Дата операции": "25.01.2024 10:15:00", "Категория": "Продукты", "Сумма операции": -2270},
        {"Дата операции": "02.02.2024 16:45:00", "Категория": "Транспорт", "Сумма операции": -590},
        {"Дата операции": "10.01.2024 08:30:00", "Категория": "Неизвестно", "Сумма операции": "Ошибка"},
    ]


@pytest.fixture
def sample_transactions_searching() -> List[Dict]:
    return [
        {
            "Дата операции": "15.01.2024 12:30:00",
            "Описание": "Оплата в кафе",
            "Категория": "Кафе",
            "Сумма операции": -500,
        },
        {
            "Дата операции": "18.01.2024 14:00:00",
            "Описание": "Перевод Иванов И.",
            "Категория": "Переводы",
            "Сумма операции": -2000,
        },
        {
            "Дата операции": "25.01.2024 10:15:00",
            "Описание": "Магазин продуктов",
            "Категория": "Продукты",
            "Сумма операции": -1500,
        },
        {
            "Дата операции": "10.02.2024 09:45:00",
            "Описание": "Перевод Петров П.",
            "Категория": "Переводы",
            "Сумма операции": -3000,
        },
        {
            "Дата операции": "05.02.2024 16:20:00",
            "Описание": "Пополнение мобильного +7 923 456-78-90",
            "Категория": "Связь",
            "Сумма операции": -500,
        },
    ]
